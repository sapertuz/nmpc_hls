function [state_dot] = model_drone(state,control,Ixx,Iyy,Izz,kM,kf,l,m,g,b,M_mma_inv,n_U)

u_param = zeros(1,n_U);
w = zeros(1,n_U);

param = [1/kf, 1/(l*kf), 1/(l*kf), 1/kM];

for i=1:n_U
    u_param(i) = control(i)*param(i);
end
for i=1:n_U
    for j=1:n_U
        w(i) = w(i) + M_mma_inv(i,j)*u_param(j);
    end
    w(i) = w(i) + b;
end

in1 = state(:);
in2 = w(:);

b = kM;
k = kf;
l = l;
m = m;
g = g;
phi = in1(4);
phidot = in1(10);
psidot = in1(12);
psi = in1(6);
thetadot = in1(11);
theta = in1(5);
u1 = in2(1);
u2 = in2(2);
u3 = in2(3);
u4 = in2(4);
xdot = in1(7);
ydot = in1(8);
zdot = in1(9);
t2 = cos(phi);
t3 = cos(psi);
t4 = cos(theta);
t5 = sin(phi);
t6 = sin(psi);
t7 = sin(theta);
t8 = Iyy^2;
t9 = Izz^2;
t10 = phi*2.0;
t11 = theta*2.0;
t12 = thetadot^2;
t21 = 1.0/Iyy;
t22 = 1.0/Izz;
t23 = 1.0/m;
t24 = u1+u2+u3+u4;
t13 = t2^2;
t14 = t2^3;
t16 = t4^2;
t17 = sin(t10);
t18 = t5^2;
t19 = sin(t11);
t20 = t7^2;
t25 = 1.0/t4;
t15 = t13^2;
t26 = t20-1.0;
t27 = 1.0/t26;
state_dot = ...
[xdot;
ydot;
zdot;
phidot;
thetadot;
psidot;

k*t23*t24*(t5*t6+t2*t3*t7);

-k*t23*t24*(t3*t5-t2*t6*t7);

-g+k*t2*t4*t23*t24;

-t7*t21*t22*t27*(Iyy-Iyy*t18+Izz*t18)*(-b*u1+b*u2-b*u3+b*u4+ ...
    (Ixx*phidot*t4*thetadot)/2.0+(Iyy*phidot*t4*thetadot)/2.0...
    -(Izz*phidot*t4*thetadot)/2.0-(Ixx*psidot*t19*thetadot)/2.0+...
    (Iyy*psidot*t19*thetadot)/2.0-Iyy*phidot*t4*t13*thetadot+...
    Izz*phidot*t4*t13*thetadot+(Iyy*t2*t5*t7*t12)/2.0-...
    (Izz*t2*t5*t7*t12)/2.0-Iyy*phidot*psidot*t2*t5*t16+...
    Izz*phidot*psidot*t2*t5*t16-Iyy*psidot*t4*t7*t13*thetadot+...
    Izz*psidot*t4*t7*t13*thetadot)-(t21*t22*t27*(-k*l*u2+k*l*u4+...
    (Ixx*psidot*t4*thetadot)/2.0)*(Iyy*Izz+Ixx*Iyy*t20-Iyy*Izz*t20-...
    Ixx*Iyy*t18*t20+Ixx*Izz*t18*t20))/Ixx+t7*t17*t21*t22*t25*...
    (Iyy/2.0-Izz/2.0)*(k*l*u1-k*l*u3-(Iyy*phidot*t17*thetadot)/2.0+...
    (Izz*phidot*t17*thetadot)/2.0-(Iyy*phidot*psidot*t4)/2.0+...
    (Izz*phidot*psidot*t4)/2.0+Iyy*phidot*psidot*t4*t13-...
    Izz*phidot*psidot*t4*t13-(Iyy*psidot*t2*t5*t7*thetadot)/2.0+...
    (Izz*psidot*t2*t5*t7*thetadot)/2.0);

(t21*t22*t25*(phidot*psidot*t8*t16-t7*t8*t12*t13-t7*t9*t12*t13+...
    t7*t8*t12*t15+t7*t9*t12*t15+Iyy*b*t17*u1-Iyy*b*t17*u2+Iyy*b*t17*u3-...
    Iyy*b*t17*u4-Izz*b*t17*u1+Izz*b*t17*u2-Izz*b*t17*u3+Izz*b*t17*u4-...
    Iyy*Izz*phidot*psidot*t16+Iyy*Izz*t7*t12*t13*2.0-...
    Iyy*Izz*t7*t12*t15*2.0-Iyy*k*l*t4*u1*2.0+Iyy*k*l*t4*u3*2.0-...
    phidot*psidot*t8*t13*t16+phidot*psidot*t9*t13*t16+...
    phidot*t2*t4*t5*t8*thetadot-phidot*t2*t4*t5*t9*thetadot+...
    Iyy*k*l*t4*t13*u1*2.0-Iyy*k*l*t4*t13*u3*2.0-Izz*k*l*t4*t13*u1*2.0+...
    Izz*k*l*t4*t13*u3*2.0-Ixx*Iyy*phidot*t2*t4*t5*thetadot+...
    Ixx*Izz*phidot*t2*t4*t5*thetadot+Iyy*k*l*t2*t5*t7*u2*2.0-...
    Iyy*k*l*t2*t5*t7*u4*2.0-Izz*k*l*t2*t5*t7*u2*2.0+...
    Izz*k*l*t2*t5*t7*u4*2.0-psidot*t2*t4*t5*t7*t8*thetadot+...
    psidot*t4*t5*t7*t8*t14*thetadot+psidot*t4*t5*t7*t9*t14*thetadot+...
    Ixx*Iyy*psidot*t2*t4*t5*t7*thetadot-Ixx*Izz*psidot*t2*t4*t5*t7*thetadot...
    +Iyy*Izz*psidot*t2*t4*t5*t7*thetadot-...
    Iyy*Izz*psidot*t4*t5*t7*t14*thetadot*2.0))/2.0;

(t21*t22*(Izz*b*u1*-2.0+Izz*b*u2*2.0-Izz*b*u3*2.0+Izz*b*u4*2.0-...
    phidot*t4*t9*thetadot-Iyy*b*t13*u1*2.0+Iyy*b*t13*u2*2.0-...
    Iyy*b*t13*u3*2.0+Iyy*b*t13*u4*2.0+Izz*b*t13*u1*2.0-Izz*b*t13*u2*2.0+...
    Izz*b*t13*u3*2.0-Izz*b*t13*u4*2.0+Ixx*Izz*phidot*t4*thetadot+...
    Iyy*Izz*phidot*t4*thetadot-(Ixx*Izz*psidot*t19*thetadot)/2.0+...
    Iyy*Izz*psidot*t19*thetadot-Izz*k*l*t7*u2*2.0+Izz*k*l*t7*u4*2.0-...
    phidot*t4*t8*t13*thetadot+phidot*t4*t9*t13*thetadot-t2*t5*t7*t9*t12+...
    t5*t7*t8*t12*t14+t5*t7*t9*t12*t14-phidot*psidot*t2*t5*t8*t16+...
    phidot*psidot*t2*t5*t9*t16+psidot*t4*t7*t8*t13*thetadot+...
    psidot*t4*t7*t9*t13*thetadot-psidot*t4*t7*t8*t15*thetadot-...
    psidot*t4*t7*t9*t15*thetadot+Ixx*Iyy*phidot*t4*t13*thetadot-...
    Ixx*Izz*phidot*t4*t13*thetadot+Iyy*Izz*t2*t5*t7*t12-...
    Iyy*Izz*t5*t7*t12*t14*2.0-Iyy*k*l*t7*t13*u2*2.0+Iyy*k*l*t7*t13*u4*2.0+...
    Izz*k*l*t7*t13*u2*2.0-Izz*k*l*t7*t13*u4*2.0-...
    Ixx*Iyy*psidot*t4*t7*t13*thetadot+Ixx*Izz*psidot*t4*t7*t13*thetadot-...
    Iyy*Izz*psidot*t4*t7*t13*thetadot*2.0+...
    Iyy*Izz*psidot*t4*t7*t15*thetadot*2.0+Iyy*k*l*t2*t4*t5*u1*2.0-...
    Iyy*k*l*t2*t4*t5*u3*2.0-Izz*k*l*t2*t4*t5*u1*2.0+...
    Izz*k*l*t2*t4*t5*u3*2.0))/(t16*2.0)];
